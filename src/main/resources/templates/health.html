<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">

    <title>Health -健康信息</title>

    <!-- Vendors Style-->
    <link rel="stylesheet" th:href="@{css/vendors_css.css}">

    <!-- Style-->
    <link rel="stylesheet" th:href="@{css/style.css}">
    <link rel="stylesheet" th:href="@{css/skin_color.css}">


</head>
<body class="hold-transition light-skin sidebar-mini theme-primary fixed">

<div class="wrapper">
    <div id="loader"></div>
    <!---------------------------------------------------------------------------------------------------------------------------------------------------->
    <!-- Content Wrapper. Contains page content -->
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="d-flex align-items-center">
            <div class="mr-auto">
                <h3 class="page-title">健康信息</h3>
                <div class="d-inline-block align-items-center">
                    <nav>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"><i class="mdi mdi-home-outline"></i></a></li>
                            <li class="breadcrumb-item" aria-current="page">健康档案</li>
                            <li class="breadcrumb-item active" aria-current="page">健康信息</li>
                        </ol>
                    </nav>
                </div>
            </div>

        </div>
    </div>

    <!-- Main content -->
    <section class="content">
        <div class="col-12">
            <div class="box">
                <div class="box-header with-border">
                    <h4 class="box-title text-info" ><i class="ti-user mr-15"></i><span th:text="${session.name}"></span> </h4>
                    <div class="box-controls pull-right">
                        <!-- <div class="ti-pencil" id="edit-icon"></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                        <div class="ti-plus" id="add-icon"></div>
                        <div class="ti-close" id="close-icon" style="display: none"></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="ti-check"  id="check-icon" style="display: none"></div>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <tr>
                                <th>序号</th>
                                <th>时间</th>
                                <th>温度(°C)</th>
                                <th>心率(BPM)</th>
                                <th>血压(收缩压mmHg)</th>
                                <th>血压(舒张压mmHg)</th>
                                <th>血糖(mmol/L)</th>
                                <th>血脂(mmol/L)</th>
                            </tr>
                            <tr id="add-input" class="add1" th:each="user, iterStat:${userHealth}" style="display: none">
                                <td id="id-input" th:text="${user.id}"> </td>
                                <td><input class="form-control" id="time-input" type="datetime-local"></td>
                                <td><input class="form-control" id="1" name="1"></td>
                                <td><input class="form-control" id="2" name="2"></td>
                                <td><input class="form-control" id="3" name="3"></td>
                                <td><input class="form-control" id="4" name="4"></td>
                                <td><input class="form-control" id="5" name="5"></td>
                                <td><input class="form-control" id="6" name="6"></td>
                            </tr>
                            <tr th:each="user, iterStat:${userHealth}">
                                <td th:text="${user.id}"> </td>
                                <td th:text="${user.updateTime}"> </td>
                                <td th:text="${user.temperature}"> </td>
                                <td th:text="${user.heartRate}"> </td>
                                <td th:text="${user.highPressure}"> </td>
                                <td th:text="${user.lowPressure}"> </td>
                                <td th:text="${user.bloodGlucose}"> </td>
                                <td th:text="${user.bloodFat}"> </td>
                            </tr>


                        </table>
                        <!--分页
                        <ul class="pagination pull-right">
                        <li class="paginate_button page-item previous" id="complex_header_previous"><a href="#"
                                                                                                       aria-controls="complex_header" data-dt-idx="0" tabindex="0" class="page-link">Previous</a></li>
                        <li class="paginate_button page-item active"><a href="#" aria-controls="complex_header" data-dt-idx="1" tabindex="0"
                                                                  class="page-link">1</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="complex_header" data-dt-idx="2" tabindex="0"
                                                                  class="page-link">2</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="complex_header" data-dt-idx="3" tabindex="0"
                                                                  class="page-link">3</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="complex_header" data-dt-idx="4" tabindex="0"
                                                                  class="page-link">4</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="complex_header" data-dt-idx="5" tabindex="0"
                                                                  class="page-link">5</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="complex_header" data-dt-idx="6" tabindex="0"
                                                                  class="page-link">6</a></li>
                        <li class="paginate_button page-item next disabled" id="complex_header_next"><a href="#"
                                                                                                        aria-controls="complex_header" data-dt-idx="7" tabindex="0" class="page-link">Next</a></li>
                    </ul>-->
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    </section>
</div>


<script th:inline="javascript">
    function open() {
        document.getElementById('add-icon').style.display = "none";
        //document.getElementById('edit-icon').style.display = "none";
        document.getElementById('check-icon').style.display = "";
        document.getElementById('close-icon').style.display = "";
        document.getElementById('add-input').style.display = "";
    }
    function close() {
        document.getElementById('add-icon').style.display = "";
        //document.getElementById('edit-icon').style.display = "";
        document.getElementById('check-icon').style.display = "none";
        document.getElementById('close-icon').style.display = "none";
        document.getElementById('add-input').style.display = "none";

    }




    function commit() {
        var i = document.getElementById('id-input').innerText;
        var a = document.getElementById('1').value;
        var b = document.getElementById('2').value;
        var c = document.getElementById('3').value;
        var d = document.getElementById('4').value;
        var e = document.getElementById('5').value;
        var g = document.getElementById('6').value;
        var f = document.getElementById('time-input').value;
        if(!a && !b && !c  && !d  && !e ){
            alert("数据为空");
        }else{
            if(!f){
                f=formatDateTime(new Date(),'yyyy-MM-dd HH:mm:ss');
            }
            let data = {
                "id":i,
                "updateTime": f,
                "temperature":a,
                "heartRate":b,
                "highPressure":c,
                "lowPressure":d,
                "bloodGlucose":e,
                "bloodFat":g,};
            $.ajax({
                url:"/health/add",
                type:"POST",
                data:data,
                dataType:"JSON",
                success:function (json) {
                    alert(json.msg);
                    window.location.reload();
                },
                error:function (xhr) {
                    alert("未知错误"+xhr.message);
                }
            })

        }

    }

    function formatDateTime(date, format) {
        const o = {
            'M+': date.getMonth() + 1, // 月份
            'd+': date.getDate(), // 日
            'h+': date.getHours() % 12 === 0 ? 12 : date.getHours() % 12, // 小时
            'H+': date.getHours(), // 小时
            'm+': date.getMinutes(), // 分
            's+': date.getSeconds(), // 秒
            'q+': Math.floor((date.getMonth() + 3) / 3), // 季度
            S: date.getMilliseconds(), // 毫秒
            a: date.getHours() < 12 ? '上午' : '下午', // 上午/下午
            A: date.getHours() < 12 ? 'AM' : 'PM', // AM/PM
        };
        if (/(y+)/.test(format)) {
            format = format.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));
        }
        for (let k in o) {
            if (new RegExp('(' + k + ')').test(format)) {
                format = format.replace(
                    RegExp.$1,
                    RegExp.$1.length === 1 ? o[k] : ('00' + o[k]).substr(('' + o[k]).length)
                );
            }
        }
        return format;
    }

    document.getElementById('add-icon').addEventListener("click",open);
    document.getElementById('close-icon').addEventListener("click",close);
    document.getElementById('check-icon').addEventListener("click",commit);
    //document.getElementById('edit-icon').addEventListener("click",commit);

</script>

<!-- Vendor JS -->
<script th:src="@{js/vendors.min.js}"></script>
<script th:src="@{js/chat-popup.js}"></script>
<script th:src="@{js/feather.min.js}"></script>

<script th:src="@{js/apexcharts.js}"></script>
<script th:src="@{js/moment.min.js}"></script>
<script th:src="@{js/fullcalendar.js}"></script>

<!-- EduAdmin App -->
<script th:src="@{js/template.js}"></script>
<script th:src="@{js/dashboard.js}"></script>
<script th:src="@{js/calendar.js}"></script>

</body>
</html>
